<?php

// Connecting to the Database
$servername = "localhost";
$username = "root";
$password = "";
$database = "user_registration";

// Create a connection
$conn = mysqli_connect($servername, $username, $password, $database);

// Die if connection was not successful
if (!$conn) {
    die("Sorry we failed to connect: " . mysqli_connect_error());
}

// Safe input handling to prevent SQL injection
// $uname = mysqli_real_escape_string($conn, trim($_POST['username']));
// $pass = mysqli_real_escape_string($conn, trim($_POST['password']));


// unsafe, allows sqli and js injections 
$uname = $_POST['username'];
$pass = md5($_POST['password']);


// Secure query to prevent SQL injection
$q = "SELECT * FROM login WHERE username='$uname' AND password='$pass'";
echo "QUERY IS ", $q;
$query = mysqli_query($conn, $q);

// Initialize a flag for successful login
$loginSuccessful = false;
?>

<!DOCTYPE HTML>
<html>
<head>
    <title>Login Result</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        table {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            border-collapse: collapse;
        }
        td, th {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #4682b4;
            color: white;
        }
        input[type="submit"] {
            background-color: #4682b4;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        input[type="submit"]:hover {
            background-color: #5a9bd4;
        }
    </style>
</head>
<body>

<?php if (mysqli_num_rows($query) > 0): ?>
    <table border="2px">
        <tr>
            <th>Username</th>
            <th>Password</th>
        </tr>
        <?php while ($res = mysqli_fetch_array($query)): ?>
            <tr>
                <td><?php echo htmlspecialchars($res['username']); ?></td>
                <td><?php echo htmlspecialchars($res['password']); ?></td>
            </tr>
        <?php endwhile; ?>
    </table>

    <!-- Display the proceed button if login is successful -->
    <form action="..\jsi\search.html">
        <input type="submit" value="Proceed to Search Page">
    </form>

    <?php
    $loginSuccessful = true;
else:
    echo "<b>Login failed. Invalid Username or Password</b>";
endif;
?>

</body>
</html>
