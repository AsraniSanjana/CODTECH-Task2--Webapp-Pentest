<!DOCTYPE html>
<html>
<head>
    <title>Injection Vulnerabilities Demo</title>
    <style>
        h2 {
            color: #4682b4;
            text-align: center;
        }
        button, input[type=submit] {
            background-color: #4682b4;
            border: 1px solid #4682b4;
            border-radius: 0 4px 4px 0;
            padding: 10px;
            cursor: pointer;
            color: #fff;
            font-size: 16px;
        }
        .form-group {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        input[type=text], textarea {
            padding: 10px;
            font-size: 16px;
            border-radius: 4px 0 0 4px;
            border: 1px solid #ccc;
        }
        .output {
            background-color: black;
            color: yellow;
            padding: 10px;
            margin-top: 20px;
        }
        * {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Injection Vulnerabilities Demo</h1>

    <h2>XML Injection</h2>
    <form method="POST" action="vulnerabilities.php#xml_injection">
        <div class="form-group">
            <textarea name="xml_input" rows="1" cols="50"></textarea>
            <input type="submit" name="xml_submit" value="Submit">
        </div>
    </form>
    <?php
    if (isset($_POST['xml_submit'])) {
        $xml_input = $_POST['xml_input'];
        libxml_disable_entity_loader(false);
        $xml = simplexml_load_string($xml_input, 'SimpleXMLElement', LIBXML_NOENT);

        if ($xml === false) {
            echo "<div class='output'>Failed to parse XML</div>";
        } else {
            echo "<div class='output'>Parsed XML: <br><pre>";
            print_r($xml);
            echo "</pre></div>";
        }
    }
    ?>

    <h2>XPath Injection</h2>
    <form method="POST" action="vulnerabilities.php#xpath_injection">
        <div class="form-group">
            <textarea name="xpath_query" rows="1" cols="50"></textarea>
            <input type="submit" name="xpath_submit" value="Submit">
        </div>
    </form>
    <?php
    if (isset($_POST['xpath_submit'])) {
        $xpath_query = $_POST['xpath_query'];
        $xml_string = '<?xml version="1.0" encoding="UTF-8"?>
        <employees>
            <employee>
                <name>John</name>
                <salary>5000</salary>
            </employee>
            <employee>
                <name>Jane</name>
                <salary>6000</salary>
            </employee>
        </employees>';
        $xml = new DOMDocument();
        $xml->loadXML($xml_string);
        $xpath = new DOMXPath($xml);
        $result = $xpath->query($xpath_query);

        if ($result === false) {
            echo "<div class='output'>Invalid XPath query</div>";
        } else {
            echo "<div class='output'>XPath Query Result: <br><pre>";
            foreach ($result as $node) {
                echo $node->nodeValue . "<br>";
            }
            echo "</pre></div>";
        }
    }
    ?>

    <h2>XQuery Injection</h2>
    <form method="POST" action="vulnerabilities.php#xquery_injection">
        <div class="form-group">
        <textarea name="xquery" rows="1" cols="50"></textarea>
            <button type="submit" name="xquery_submit" value="Submit">Submit</button>
        </div>
    </form>
    <?php
    if (isset($_POST['xquery_submit'])) {
        $xquery = $_POST['xquery'];
        $xml_string = '<?xml version="1.0" encoding="UTF-8"?>
        <employees>
            <employee>
                <name>John</name>
                <salary>5000</salary>
            </employee>
            <employee>
                <name>Jane</name>
                <salary>6000</salary>
            </employee>
        </employees>';

        try {
            $xml = new SimpleXMLElement($xml_string);
            $salaries = [];
            foreach ($xml->employee as $employee) {
                $salaries[] = (int)$employee->salary;
            }
            $max_salary = max($salaries);
            echo "<div class='output'>XQuery Alternative Result: <br>Max Salary: $max_salary</div>";
        } catch (Exception $e) {
            echo "<div class='output'>XQuery Evaluation Failed: " . $e->getMessage() . "</div>";
        }
    }
    ?>

    <h2>Template Injection</h2>
    <form method="POST" action="vulnerabilities.php#template_injection">
        <div class="form-group">
            <textarea name="template_input" rows="1" cols="50"></textarea>
            <input type="submit" name="template_submit" value="Submit">
        </div>
    </form>
    <?php
    if (isset($_POST['template_submit'])) {
        $template_input = $_POST['template_input'];
        $template = "Hello, {{name}}! Welcome to our site.";

        $output = str_replace('{{name}}', $template_input, $template);
        echo "<div class='output'>Template Output: <br>";
        echo $output;
        echo "</div>";
    }
    ?>
</body>
</html>
