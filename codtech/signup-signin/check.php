<?php
$servername = "localhost";
$username = "root";
$password = "";
$database = "user_registration";

$conn = mysqli_connect($servername, $username, $password, $database);

if (!$conn) {
    die("Sorry we failed to connect: " . mysqli_connect_error());
}

// unsafe input handling to demonstrate SQL injection
$uname = $_POST['username'];
$pass = md5($_POST['password']);

// unsafe query to demonstrate SQL injection
$q = "SELECT * FROM login WHERE username='$uname' AND password='$pass'";
echo "QUERY IS ", $q;
$query = mysqli_query($conn, $q);

?>

<!DOCTYPE HTML>
<html>
<head>
    <title>Login Result</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        table {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            border-collapse: collapse;
        }
        td, th {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #4682b4;
            color: white;
        }
        input[type="submit"] {
            background-color: #4682b4;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        input[type="submit"]:hover {
            background-color: #5a9bd4;
        }
    </style>
</head>
<body>

<?php if (mysqli_num_rows($query) > 0): ?>
    <table border="2px">
        <tr>
            <th>Username</th>
            <th>Password</th>
        </tr>
        <?php while ($res = mysqli_fetch_array($query)): ?>
            <tr>
                <td><?php echo htmlspecialchars($res['username']); ?></td>
                <td><?php echo htmlspecialchars($res['password']); ?></td>
            </tr>
        <?php endwhile; ?>
    </table>

    <!-- redirect to search page with username in the URL as param-->
    <form action="../post-login/dashboard.php" method="get">
        <input type="hidden" name="user" value="<?php echo htmlspecialchars($uname); ?>">
        <input type="submit" value="Proceed to Dashboard">
    </form>

<?php else: ?>
    <b>Login failed. Invalid Username or Password</b>
<?php endif; ?>

</body>
</html>